<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>QP-nano: 7. Coding Hierarchical State Machines</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.4 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
  </ul>
</div>
<div class="nav">
<a class="el" href="index.html">QP-nano Reference Manual</a>&nbsp;&raquo&nbsp;<a class="el" href="tutorial_page.html">QP-nano Tutorial</a></div>
<h1><a class="anchor" name="coding_hsm">7. Coding Hierarchical State Machines </a></h1><em>This QP-nano Tutorial is adapted from Chapter 1 of <a class="el" href="index.html#PSiCC2">Practical UML Statecharts in C/C++, Second Edition</a><br>
 by Miro Samek, the founder and president of Quantum Leaps, LLC.</em><p>
<div align="center">
<img src="qp_tutorial.jpg" alt="qp_tutorial.jpg">
</div>
<p>
Prev: <a class="el" href="events.html">6. Signals, Events, and Active Objects</a> <br>
 Next: <a class="el" href="execution.html">8. Using the Built-in Real-Time Kernels</a><p>
Contrary to widespread misconceptions, you don't need big design automation tools to translate hierarchical state machines (UML statecharts) into efficient and highly maintainable C or C++. This section explains how to hand-code the Ship state machine from <a class="el" href="active_objects.html#F5s2">Figure 5-2</a> with QP-nano. Once you know how to code this state machine, you know how to code them all.<p>
The source code for the Ship state machine is found in the file <code>ship.c</code> located either in the DOS version or the Cortex-M3 version of the "Fly 'n' Shoot" game. I break the explanation of this file into <b>three</b> steps.<h2><a class="anchor" name="step1">
7.1 Step 1: Defining the Ship Structure</a></h2>
In the first step you define the Ship data structure. Just like in case of events, you use inheritance to derive the Ship structure from the framework structure <a class="el" href="struct_q_active.html" title="Active Object struct.">QActive</a> (see the sidebar <a class="el" href="derivation.html">Encapsulation and Single Inheritance in C</a>). Creating this inheritance relationship ties the Ship structure to the QF framework. The main responsibility of the <a class="el" href="struct_q_active.html" title="Active Object struct.">QActive</a> base structure is to store the information about the current active state of the state machine, as well as the event queue and priority level of the Ship active object. In fact, <a class="el" href="struct_q_active.html" title="Active Object struct.">QActive</a> itself derives from a simpler QEP structure QHsm that represents just the current active state of a hierarchical state machine. On top of that information, almost every state machine must also store other "extended-state" information. For example, the Ship object is responsible for maintaining the Ship position as well as the score accumulated in the game. You supply this additional information by means of data members enlisted after the base structure member super, as shown in <a class="el" href="coding_hsm.html#L7s1">Listing 7-1</a>.<p>
<a class="anchor" name="L7s1"></a> <b>Listing 7-1 Deriving the Ship structure in file ship.c.</b> <div class="fragment"><pre class="fragment"> (1) #include <span class="stringliteral">"qpn_port.h"</span>
 (2) #include <span class="stringliteral">"bsp.h"</span>
 (3) #include <span class="stringliteral">"game.h"</span>

     <span class="comment">/* local objects -----------------------------------------------------------*/</span>
 (4) typedef struct ShipTag {
 (5)     <a class="code" href="struct_q_active.html" title="Active Object struct.">QActive</a> super;                              <span class="comment">/* extend the QActive class */</span>
         uint8_t x;
         uint8_t y;
         uint8_t exp_ctr;
         uint16_t score;
     } Ship;                                           <span class="comment">/* the Ship active object */</span>

 (6) <span class="keyword">static</span> <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_initial  (Ship *me);
 (7) <span class="keyword">static</span> <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_active   (Ship *me);
     <span class="keyword">static</span> <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_parked   (Ship *me);
     <span class="keyword">static</span> <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_flying   (Ship *me);
     <span class="keyword">static</span> <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_exploding(Ship *me);

     <span class="comment">/* global objects ----------------------------------------------------------*/</span>
 (8) Ship AO_Ship;
</pre></div><p>
<ul>
<li>(1) Every application-level C-file that uses the QP platform must include the <code>qp_port.h</code> header file.</li>
</ul>
<ul>
<li>(2) The <code>bsp.h</code> header file contains the interface to the Board Support Package.</li>
</ul>
<ul>
<li>(3) The <code>game.h</code> header file contains the declarations of events and other facilities shared among the components of the application </li>
<li>(see <a class="el" href="events.html#L6s1">Listing 6-1</a>).</li>
</ul>
<ul>
<li>(4) This structure defines the Ship active object.</li>
</ul>
<ul>
<li>(5) The Ship active object structure derives from the framework structure <a class="el" href="struct_q_active.html" title="Active Object struct.">QActive</a>, as described in Section .</li>
</ul>
<ul>
<li>(6) The <code>Ship_initial()</code> function defines the top-most initial transition in the Ship state machine. The initial pseudostate handler has signature identical to the regular state handler function.</li>
</ul>
<ul>
<li>(7) The state-handler functions in QP-nano also don't take the event parameter. (In QP-nano, the current event is embedded in the state machine.) As in the full-version QP, a state handler function in QP-nano returns a pointer the superstate handler function.</li>
</ul>
<dl class="note" compact><dt><b>Note:</b></dt><dd>I use a simple naming convention to strengthen the association between the structures and the functions designed to operate on these structures. First, I name the functions by combining the typedef'ed structure name with the name of the operation (e.g., <code>Ship_active</code>). Second, I always place the pointer to the structure as the first argument of the associated function and I always name this argument <code>me</code> (e.g., <code>Ship_active(Ship *me, ...)</code>).</dd></dl>
<ul>
<li>(8) In this line I allocate the global <code>AO_Ship</code> active object. Please note that actual structure definition for the Ship active object is accessible only locally at the file scope of the <code>ship.c</code> file.</li>
</ul>
<dl class="note" compact><dt><b>Note:</b></dt><dd>QP-nano assumes that all global or static variables without explicit initialization value are initialized to zero upon the system startup, which is a requirement of the ANSI-C standard. You should make sure that your startup code clears the static variables data section (a.k.a. Block Started by Symbol section or BSS) before calling <code>main()</code>.</dd></dl>
<h2><a class="anchor" name="step2">
7.2 Step 2: Initializing the State Machine</a></h2>
The state machine initialization is divided into the following two steps for increased flexibility and better control of the initialization timeline:<p>
<ol type=1>
<li>The state machine "constructor"; and</li><li>The top-most initial transition.</li></ol>
<p>
The state machine "constructor", such as <code>Ship_ctor()</code>, intentionally does not execute the top-most initial transition defined in the initial pseudostate because at that time some vital objects can be missing and critical hardware might not be properly initialized yet3. Instead, the state machine "constructor" merely puts the state machine in the initial pseudostate. Later, the user code must trigger the top-most initial transition explicitly, which happens actually inside the function QActive_start() (see <a class="el" href="main_function.html#L3s1">Listing 3-11</a>(18-20)). <a class="el" href="coding_hsm.html#L7s2">Listing 7-2</a> shows the instantiation (the "constructor" function) and initialization (the initial pseudostate) of the Ship active object.<p>
<a class="anchor" name="L7s2"></a> <b>Listing 7-2 Instantiation and Initialization of the Ship active object in ship.c.</b> <div class="fragment"><pre class="fragment"> (1) <span class="keywordtype">void</span> Ship_ctor(<span class="keywordtype">void</span>) {
 (2)     Ship *me = &amp;AO_Ship;
 (3)     <a class="code" href="qfn_8h.html#7ddf2dd243b2bc13589a9c7d22f0e253" title="Active object constructor.">QActive_ctor</a>(&amp;me-&gt;super, (<a class="code" href="qepn_8h.html#3ce817b1fa0dc321de5e1403a11d4fa3" title="the signature of a state handler function">QStateHandler</a>)&amp;Ship_initial);
 (4)     me-&gt;x = GAME_SHIP_X;
 (5)     me-&gt;y = GAME_SHIP_Y;
     }

     <span class="comment">/* HSM definition ----------------------------------------------------------*/</span>
 (6) <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_initial(Ship *me) {
 (7)     <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#8f06cd90ba5060780fc61a4810e3eb50" title="Designates a target for an initial or regular transition. Q_TRAN() can be used both...">Q_TRAN</a>(&amp;Ship_active);             <span class="comment">/* top-most initial transition */</span>
     }
</pre></div><p>
<ul>
<li>(1) The global function Ship_ctor() is prototyped in game.h and called at the beginning of main().</li>
</ul>
<ul>
<li>(2) The "me" pointer points to the statically allocated Ship object (see <a class="el" href="coding_hsm.html#L7s1">Listing 7-1</a>(6)).</li>
</ul>
<ul>
<li>(3) Every derived structure is responsible for initializing the part inherited from the base structure. The "constructor" <a class="el" href="qfn_8h.html#7ddf2dd243b2bc13589a9c7d22f0e253" title="Active object constructor.">QActive_ctor()</a> puts the state machine in the initial pseudostate &amp;Ship_initial. (see <a class="el" href="events.html#L6s1">Listing 6-1</a>(5)).</li>
</ul>
<ul>
<li>(4-5) The Ship position is initialized.</li>
</ul>
<ul>
<li>(6) The Ship_initial() function defines the top-most initial transition in the Ship state machine (see <a class="el" href="active_objects.html#F5s2">Figure 5-2</a>(1)).</li>
</ul>
<ul>
<li>(7) The initial state "active" is specified by invoking the QEP-nano macro <a class="el" href="qepn_8h.html#8f06cd90ba5060780fc61a4810e3eb50" title="Designates a target for an initial or regular transition. Q_TRAN() can be used both...">Q_TRAN()</a>.</li>
</ul>
<h2><a class="anchor" name="step3">
7.3 Step 3: Defining State Handler Functions</a></h2>
In the last step, you actually code the Ship state machine by implementing one state at a time as a state handler function. To determine what elements belong the any given state handler function, you follow around the state's boundary in the diagram (<a class="el" href="active_objects.html#F5s2">Figure 5-2</a>). You need to implement all transitions originating at the boundary, any entry and exit actions defined in the state, as well as all internal transitions enlisted directly in the state. Additionally, if there is an initial transition embedded directly in the state, you need to implement it as well.<p>
Take for example the state "flying" shown in <a class="el" href="active_objects.html#F5s2">Figure 5-2</a>. This state has an entry action and two transitions originating at its boundary: <code>HIT_WALL</code> and <code>HIT_MINE(type)</code>, as well as three internal transitions <code>TIME_TICK</code>, <code>PLAYER_TRIGGER</code>, and <code>DESTROYED_MINE(score)</code>. The "flying" state nests inside the "active" superstate. <a class="el" href="coding_hsm.html#L7s3">Listing 7-3</a> shows two state handler functions of the Ship state machine from <a class="el" href="active_objects.html#F5s2">Figure 5-2</a>. The state handler functions correspond to the states "active" and "flying", respectively. The explanation section immediately following the listing highlights the important implementation techniques.<p>
<a class="anchor" name="L7s3"></a> <b>Listing 7-3 State handler functions for states "active" and "flying" in ship.c.</b> <div class="fragment"><pre class="fragment">     <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_active(Ship *me) {
 (1)     <span class="keywordflow">switch</span> (<a class="code" href="qepn_8h.html#a094e6aed843e73b91fc3879e79139d5" title="macro to access the signal of the current event of a state machine">Q_SIG</a>(me)) {
             <span class="keywordflow">case</span> <a class="code" href="qepn_8h.html#e35e58b2153d1c63307c068315be907428691a94425fb031be4044e817e21a60">Q_INIT_SIG</a>: {                     <span class="comment">/* nested initial transition */</span>
 (2)             <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#8f06cd90ba5060780fc61a4810e3eb50" title="Designates a target for an initial or regular transition. Q_TRAN() can be used both...">Q_TRAN</a>(&amp;Ship_parked);
             }
             <span class="keywordflow">case</span> PLAYER_SHIP_MOVE_SIG: {
 (3)             me-&gt;x = (uint8_t)<a class="code" href="qepn_8h.html#1ca2c1f35037231e6fe510fa70fe6bb5" title="macro to access the parameter of the current event of a state machine">Q_PAR</a>(me);
 (4)             me-&gt;y = (uint8_t)(<a class="code" href="qepn_8h.html#1ca2c1f35037231e6fe510fa70fe6bb5" title="macro to access the parameter of the current event of a state machine">Q_PAR</a>(me) &gt;&gt; 8);
 (5)             <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#54b2da5e70ef983cfa7ca74deac237a3" title="Value returned by a state-handler function when it handles the event.">Q_HANDLED</a>();
             }
         }
 (6)     <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#d8abd2f7098c41ec464343d9d8f1eadc" title="Designates the superstate of a given state in an HSM.">Q_SUPER</a>(&amp;<a class="code" href="qepn_8h.html#610f1deb5bf3b5d4ad7f605e0fbc2e30" title="The top-state.">QHsm_top</a>);
     }
     <span class="comment">/*..........................................................................*/</span>
     <a class="code" href="qepn_8h.html#76c35d858e243d1bd3106738573902d0" title="Type returned from a state-handler function.">QState</a> Ship_flying(Ship *me) {
         <span class="keywordflow">switch</span> (<a class="code" href="qepn_8h.html#a094e6aed843e73b91fc3879e79139d5" title="macro to access the signal of the current event of a state machine">Q_SIG</a>(me)) {
             <span class="keywordflow">case</span> <a class="code" href="qepn_8h.html#e35e58b2153d1c63307c068315be9074c286909dd59290d1076b51d4cfdfaefe">Q_ENTRY_SIG</a>: {
                 me-&gt;score = 0;                               <span class="comment">/* reset the score */</span>
 (7)             <a class="code" href="qfn_8h.html#079baf20c44aae3d8b6bc1200c0b07a1" title="Posts an event e directly to the event queue of the acitve object prio using the...">QActive_post</a>((<a class="code" href="struct_q_active.html" title="Active Object struct.">QActive</a> *)&amp;AO_Tunnel, SCORE_SIG, me-&gt;score);
                 <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#54b2da5e70ef983cfa7ca74deac237a3" title="Value returned by a state-handler function when it handles the event.">Q_HANDLED</a>();
             }
             <span class="keywordflow">case</span> TIME_TICK_SIG: {
                 <span class="comment">/* tell the Tunnel to draw the Ship and test for hits */</span>
 (8)             <a class="code" href="qfn_8h.html#079baf20c44aae3d8b6bc1200c0b07a1" title="Posts an event e directly to the event queue of the acitve object prio using the...">QActive_post</a>((<a class="code" href="struct_q_active.html" title="Active Object struct.">QActive</a> *)&amp;AO_Tunnel, SHIP_IMG_SIG,
                              ((<a class="code" href="qepn_8h.html#691c7fae67ced229a9dd9fa1ef048379" title="type of the event parameter.">QParam</a>)SHIP_BMP &lt;&lt; 16)
                              | (<a class="code" href="qepn_8h.html#691c7fae67ced229a9dd9fa1ef048379" title="type of the event parameter.">QParam</a>)me-&gt;x
                              | ((<a class="code" href="qepn_8h.html#691c7fae67ced229a9dd9fa1ef048379" title="type of the event parameter.">QParam</a>)me-&gt;y &lt;&lt; 8));

                 ++me-&gt;score;  <span class="comment">/* increment the score for surviving another tick */</span>
                 <span class="keywordflow">if</span> ((me-&gt;score % 10) == 0) {           <span class="comment">/* is the score "round"? */</span>
                     <a class="code" href="qfn_8h.html#079baf20c44aae3d8b6bc1200c0b07a1" title="Posts an event e directly to the event queue of the acitve object prio using the...">QActive_post</a>((<a class="code" href="struct_q_active.html" title="Active Object struct.">QActive</a> *)&amp;AO_Tunnel, SCORE_SIG, me-&gt;score);
                 }
                 <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#54b2da5e70ef983cfa7ca74deac237a3" title="Value returned by a state-handler function when it handles the event.">Q_HANDLED</a>();
             }
             <span class="keywordflow">case</span> PLAYER_TRIGGER_SIG: {                   <span class="comment">/* trigger the Missile */</span>
                 <a class="code" href="qfn_8h.html#079baf20c44aae3d8b6bc1200c0b07a1" title="Posts an event e directly to the event queue of the acitve object prio using the...">QActive_post</a>((<a class="code" href="struct_q_active.html" title="Active Object struct.">QActive</a> *)&amp;AO_Missile, MISSILE_FIRE_SIG,
                              (<a class="code" href="qepn_8h.html#691c7fae67ced229a9dd9fa1ef048379" title="type of the event parameter.">QParam</a>)me-&gt;x
                              | (((<a class="code" href="qepn_8h.html#691c7fae67ced229a9dd9fa1ef048379" title="type of the event parameter.">QParam</a>)me-&gt;y + SHIP_HEIGHT - 1) &lt;&lt; 8));
                 <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#54b2da5e70ef983cfa7ca74deac237a3" title="Value returned by a state-handler function when it handles the event.">Q_HANDLED</a>();
             }
             <span class="keywordflow">case</span> DESTROYED_MINE_SIG: {
                 me-&gt;score += <a class="code" href="qepn_8h.html#1ca2c1f35037231e6fe510fa70fe6bb5" title="macro to access the parameter of the current event of a state machine">Q_PAR</a>(me);
                 <span class="comment">/* the score will be sent to the Tunnel by the next TIME_TICK */</span>
                 <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#54b2da5e70ef983cfa7ca74deac237a3" title="Value returned by a state-handler function when it handles the event.">Q_HANDLED</a>();
             }
             <span class="keywordflow">case</span> HIT_WALL_SIG:
             <span class="keywordflow">case</span> HIT_MINE_SIG: {
 (9)             <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#8f06cd90ba5060780fc61a4810e3eb50" title="Designates a target for an initial or regular transition. Q_TRAN() can be used both...">Q_TRAN</a>(&amp;Ship_exploding);
             }
         }
(10)     <span class="keywordflow">return</span> <a class="code" href="qepn_8h.html#d8abd2f7098c41ec464343d9d8f1eadc" title="Designates the superstate of a given state in an HSM.">Q_SUPER</a>(&amp;Ship_active);
     }
</pre></div><p>
<ul>
<li>(1) Every state handler is structured as a switch statement that discriminates based on the signal of the event, which in QP-nano is obtained by the macro <a class="el" href="qepn_8h.html#a094e6aed843e73b91fc3879e79139d5" title="macro to access the signal of the current event of a state machine">Q_SIG(me)</a>.</li>
</ul>
<ul>
<li>(2) You designate the target of a nested initial transition with the <a class="el" href="qepn_8h.html#8f06cd90ba5060780fc61a4810e3eb50" title="Designates a target for an initial or regular transition. Q_TRAN() can be used both...">Q_TRAN()</a> macro.</li>
</ul>
<dl class="note" compact><dt><b>Note:</b></dt><dd>The macro <a class="el" href="qepn_8h.html#8f06cd90ba5060780fc61a4810e3eb50" title="Designates a target for an initial or regular transition. Q_TRAN() can be used both...">Q_TRAN()</a> must always follow the return statement.</dd></dl>
<ul>
<li>(3-4) You access the data members of the Ship state machine via the "me" parameter of the state handler function. You access the event parameters via the <a class="el" href="qepn_8h.html#1ca2c1f35037231e6fe510fa70fe6bb5" title="macro to access the parameter of the current event of a state machine">Q_PAR(me)</a> macro. Please note that in this case actually two logical event parameters are e from the scalar QP-nano parameter. The x coordinate of the Ship is sent in the least-significant byte, and the y coordinate in the next byte.</li>
</ul>
<dl class="note" compact><dt><b>Note:</b></dt><dd>Each event can have as many event parameters as you can squeeze into the available bits.</dd></dl>
<ul>
<li>(5) You terminate the case statement with <code>return <a class="el" href="qepn_8h.html#54b2da5e70ef983cfa7ca74deac237a3" title="Value returned by a state-handler function when it handles the event.">Q_HANDLED()</a></code>, which informs QEP-nano that the initial transition has been handled.</li>
</ul>
<ul>
<li>(6) The final <code>return</code> from a state handler function designates the superstate of that state, which is exactly the same as in the full-version QP. QEP-nano provides the "top" state as a state handler function <a class="el" href="qepn_8h.html#610f1deb5bf3b5d4ad7f605e0fbc2e30" title="The top-state.">QHsm_top()</a>, and therefore the <code>Ship_active()</code> state handler returns the pointer &amp;QHsm_top. (see the Ship state diagram in <a class="el" href="active_objects.html#F5s2">Figure 5-2</a>)</li>
</ul>
<ul>
<li>(7) The function <a class="el" href="qfn_8h.html#079baf20c44aae3d8b6bc1200c0b07a1" title="Posts an event e directly to the event queue of the acitve object prio using the...">QActive_post()</a> posts the specified event signal and parameter directly to the recipient active object. Direct event posting is the only event delivery mechanism supported in QP-nano.</li>
</ul>
<dl class="note" compact><dt><b>Note:</b></dt><dd>You use <a class="el" href="qfn_8h.html#079baf20c44aae3d8b6bc1200c0b07a1" title="Posts an event e directly to the event queue of the acitve object prio using the...">QActive_post()</a> function at the task-level. You should <b>never</b> call <a class="el" href="qfn_8h.html#d0a147ddbdfc4d9450f64515ae75f7a6" title="Posts an event e directly to the event queue of the acitve object prio using the...">QActive_postISR()</a> from the task-level.</dd></dl>
<ul>
<li>(8) The event posting demonstrates how to combine several logical event parameters into the single scalar parameter managed by QP-nano. Of course, you must be careful not to overflow the dynamic range of the QP-nano parameter configured with the <a class="el" href="qpn__port_8h.html#44b94e1d4ae451b6c67d6503999714a8" title="The size (in bytes) of the single scalar parameter representation in the QEvent struct...">Q_PARAM_SIZE</a> macro (see <a class="el" href="main_function.html#L3s2">Listing 3-2</a>(1)).</li>
</ul>
<ul>
<li>(9) You designate the target of a transition with the <a class="el" href="qepn_8h.html#8f06cd90ba5060780fc61a4810e3eb50" title="Designates a target for an initial or regular transition. Q_TRAN() can be used both...">Q_TRAN()</a> macro.</li>
</ul>
<ul>
<li>(10) The state "flying" (see <a class="el" href="active_objects.html#F5s2">Figure 5-2</a>) nests in the state "active", so the state handler <code>Ship_flying()</code> returns the pointer <code>&amp;Ship_active</code>.</li>
</ul>
When implementing state handler functions you need to keep in mind that the QEP-nano event processor is in charge here rather than your code. QEP-nano will invoke a state handler function for various reasons: for hierarchical event processing, for execution of entry and exit actions, for triggering initial transitions, or even just to elicit the superstate of a given state handler. Therefore, you should not assume that a state handler would be invoked only for processing signals enlisted in the case statements. You should avoid any code outside the switch statement, especially code that would have side effects.<p>
Prev: <a class="el" href="events.html">6. Signals, Events, and Active Objects</a> <br>
 Next: <a class="el" href="execution.html">8. Using the Built-in Real-Time Kernels</a><p>
<div align="center">
<img src="logo_ql_TM.jpg" alt="logo_ql_TM.jpg">
</div>
 Copyright &copy; 2002-2008 Quantum Leaps, LLC. All Rights Reserved.<br>
 <a href="http://www.quantum-leaps.com">http://www.quantum-leaps.com</a> <hr size="1"><address style="text-align: right;"><small>Generated on Thu Apr 9 13:26:46 2009 for QP-nano by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.4 </small></address>
</body>
</html>
